<!DOCTYPE html>
<html>
<head>
<script>

const remote = require('electron').remote;
//const list = list_components.js;

function loadXMLDoc(filename)
{
  process.stderr.write("Loading " + filename + '\n');
  if (window.ActiveXObject)
  {
      xhttp = new ActiveXObject("Msxml2.XMLHTTP");
  }
  else
  {
      xhttp = new XMLHttpRequest();
  }
  xhttp.open("GET", filename, false);
  xhttp.send("");
  return xhttp.responseXML;
}


function performXSLTTranslation(options)
{
  xml = loadXMLDoc(options['--xmlFile']);
  xsl = loadXMLDoc(options['--xsltFile']);

  // code for IE
  if (window.ActiveXObject || xhttp.responseType == "msxml-document")
  {
    ex = xml.transformNode(xsl);
    document.getElementById("example").innerHTML = ex;
  }
  // code for Chrome, Firefox, Opera, etc.
  else if (document.implementation && document.implementation.createDocument)
  {
    xsltProcessor = new XSLTProcessor();
    process.stderr.write("Importing stylesheet..\n")
    if (options['--attribute'] != undefined) {
      process.stderr.write("Setting attribute to: \n" + options['--attribute'])
      xsltProcessor.setParameter(null, "attribute", options['--attribute'])
    }
    xsltProcessor.importStylesheet(xsl);
    process.stderr.write("Attempting transform..\n")
    let resultDocument = xsltProcessor.transformToDocument(xml, document);
    process.stderr.write(resultDocument.body.innerHTML)
  }
}

var getOptions = function(args) {
  let options = {};
  for (let index = 1; index < args.length; index++) {
    keyPair = args[index].split('='); 
    if (keyPair.length == 2) {
      options[keyPair[0]] = keyPair[1];
    }
  }
  if (options['--debug'] == 'true') {
    for (let optionIndex in options){
      process.stderr.write("option: " + optionIndex + " = " + options[optionIndex] + "\n");
    }
  }
  return options;
};

var parseOptions= function() {
  let arguments = remote.getGlobal('sharedObject').prop1;
  let options = getOptions(arguments);
  if ((options['--xmlFile'] == null) || (options['--xsltFile'] == null))
  {
    process.stderr.write('I need at least an xmlFile and an xsltFile')
    window.close();
  }
  performXSLTTranslation(options);
  window.close();
};

</script>
</head>
<body onload="parseOptions()">
</body>
</html> 
